# ุฑุงูููุง ฺฉุงูู ุฑุงูโุงูุฏุงุฒ PostgreSQL ุจุฑุง ูพุฑูฺู ุงุฑูู

## ๐ฏ ูุฏู
ุงู ุฑุงูููุง ุจู ุดูุง ฺฉูฺฉ ูโฺฉูุฏ ุชุง PostgreSQL ุฑุง ุฑุงูโุงูุฏุงุฒ ฺฉูุฏ ู ูพุฑูฺู ุฑุง ุจู ุฏุชุงุจุณ ูุตู ฺฉูุฏ.

---

## ๐ ฺฏุงู 1: ุจุฑุฑุณ ูุตุจ PostgreSQL

PostgreSQL ุจุงุฏ ุฑู ุณุณุชู ุดูุง ูุตุจ ุจุงุดุฏ. ุจุฑุง ุจุฑุฑุณ:

```bash
psql --version
```

ุงฺฏุฑ ูุตุจ ูุณุชุ ูุตุจ ฺฉูุฏ:

```bash
sudo apt update
sudo apt install postgresql postgresql-contrib
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

---

## ๐ ฺฏุงู 2: ุงุฌุงุฏ ุฏุชุงุจุณ (ุฑูุด ุขุณุงู)

### ุฑูุด 1: ุงุณุชูุงุฏู ุงุฒ ุงุณฺฉุฑูพุช ุฎูุฏฺฉุงุฑ

```bash
./setup-database.sh
```

ุงู ุงุณฺฉุฑูพุช ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ:
- โ ุณุฑูุณ PostgreSQL ุฑุง ุฑุงูโุงูุฏุงุฒ ูโฺฉูุฏ
- โ ุฏุชุงุจุณ `irooni` ุฑุง ุงุฌุงุฏ ูโฺฉูุฏ
- โ ฺฉุงุฑุจุฑ `irooni_user` ุฑุง ุงุฌุงุฏ ูโฺฉูุฏ
- โ ุฏุณุชุฑุณโูุง ูุงุฒู ุฑุง ุชูุธู ูโฺฉูุฏ

### ุฑูุด 2: ุฏุณุช

```bash
# ูุฑูุฏ ุจู PostgreSQL
sudo -u postgres psql

# ุฏุฑ PostgreSQL shell ุงู ุฏุณุชูุฑุงุช ุฑุง ุงุฌุฑุง ฺฉูุฏ:
CREATE DATABASE irooni;
CREATE USER irooni_user WITH PASSWORD 'irooni_pass_2024';
GRANT ALL PRIVILEGES ON DATABASE irooni TO irooni_user;
\c irooni
GRANT ALL ON SCHEMA public TO irooni_user;
\q
```

---

## โ๏ธ ฺฏุงู 3: ุชูุธู ูุงู .env

ูุงู `.env` ุฑุง ุจุงุฒ ฺฉูุฏ ู `DATABASE_URL` ุฑุง ุจู ุงู ุตูุฑุช ุชูุธู ฺฉูุฏ:

```env
DATABASE_URL="postgresql://irooni_user:irooni_pass_2024@localhost:5432/irooni?schema=public"
```

**ูฺฉุชู ุงููุช:** ุงฺฏุฑ ุฑูุฒ ุนุจูุฑ ุฏฺฏุฑ ุงูุชุฎุงุจ ฺฉุฑุฏุฏุ ุขู ุฑุง ุฌุงฺฏุฒู ฺฉูุฏ.

---

## โ ฺฏุงู 4: ุชุณุช ุงุชุตุงู

### ุฑูุด 1: ุจุง Prisma CLI

```bash
# ุชููุฏ Prisma Client
npm run db:generate

# ุงุนูุงู schema ุจู ุฏุชุงุจุณ
npm run db:push
```

ุงฺฏุฑ ุฎุทุง ูุฏุงุดุชุ ุนู ุงุชุตุงู ูููู ุจูุฏู ุงุณุช! ๐

### ุฑูุด 2: ุจุง Prisma Studio

```bash
npm run db:studio
```

ุงู ุฏุณุชูุฑ ฺฉ ุฑุงุจุท ฺฏุฑุงูฺฉ ุจุงุฒ ูโฺฉูุฏ ฺฉู ูโุชูุงูุฏ ุฏุชุงุจุณ ุฑุง ุจุจูุฏ.

### ุฑูุด 3: ุจุง API Route

ุณุฑูุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:
```bash
npm run dev
```

ุณูพุณ ุฏุฑ ูุฑูุฑฺฏุฑ ุจู ุงู ุขุฏุฑุณ ุจุฑูุฏ:
```
http://localhost:3000/api/test-db
```

ุงฺฏุฑ ูพุงู ููููุช ุฏุฏุฏุ ุนู ุงุชุตุงู ฺฉุงุฑ ูโฺฉูุฏ! โ

---

## ๐ ฺฏุงู 5: ุจุฑุฑุณ ุงุชุตุงู ุจุง ุฏุณุชูุฑุงุช

### ุจุฑุฑุณ ุฏุชุงุจุณ:

```bash
# ูุฑูุฏ ุจู PostgreSQL
sudo -u postgres psql

# ูุดุงูุฏู ุฏุชุงุจุณโูุง
\l

# ูุฑูุฏ ุจู ุฏุชุงุจุณ irooni
\c irooni

# ูุดุงูุฏู ุฌุฏุงูู
\dt

# ุฎุฑูุฌ
\q
```

### ุชุณุช ุงุชุตุงู ุงุฒ ุฎุท ูุฑูุงู:

```bash
psql -h localhost -U irooni_user -d irooni
```

---

## ๐๏ธ ุนุจโุงุจ

### ูุดฺฉู 1: ุฎุทุง "connection refused"

**ุฑุงู ุญู:**
```bash
sudo systemctl start postgresql
sudo systemctl status postgresql
```

### ูุดฺฉู 2: ุฎุทุง "authentication failed"

**ุฑุงู ุญู:** ุจุฑุฑุณ ฺฉูุฏ ฺฉู:
- ูุงู ฺฉุงุฑุจุฑ ู ุฑูุฒ ุนุจูุฑ ุฏุฑ `.env` ุฏุฑุณุช ุจุงุดุฏ
- ฺฉุงุฑุจุฑ ุฏุฑ PostgreSQL ุงุฌุงุฏ ุดุฏู ุจุงุดุฏ

### ูุดฺฉู 3: ุฎุทุง "database does not exist"

**ุฑุงู ุญู:** ุฏุชุงุจุณ ุฑุง ุฏูุจุงุฑู ุงุฌุงุฏ ฺฉูุฏ:
```bash
./setup-database.sh
```

---

## ๐ ุฏุณุชูุฑุงุช ููุฏ

```bash
# ูุดุงูุฏู ูุถุนุช ุณุฑูุณ
sudo systemctl status postgresql

# ุฑุงูโุงูุฏุงุฒ ุณุฑูุณ
sudo systemctl start postgresql

# ุชููู ุณุฑูุณ
sudo systemctl stop postgresql

# ุฑุงูโุงูุฏุงุฒ ูุฌุฏุฏ
sudo systemctl restart postgresql

# ูุดุงูุฏู ูุงฺฏโูุง
sudo journalctl -u postgresql -f
```

---

## ๐ ุจุนุฏ ุงุฒ ุงุชุตุงู ูููู

ุจุนุฏ ุงุฒ ุงูฺฉู ุงุชุตุงู ุจุฑูุฑุงุฑ ุดุฏุ ูโุชูุงูุฏ:

1. **ูุฏูโูุง Prisma ุฑุง ุชุนุฑู ฺฉูุฏ** ุฏุฑ `prisma/schema.prisma`
2. **Migration ุงุฌุงุฏ ฺฉูุฏ** ุจุง `npm run db:migrate`
3. **ุงุฒ Prisma ุฏุฑ ฺฉุฏ ุงุณุชูุงุฏู ฺฉูุฏ** ุจุง `import { prisma } from '@/lib/prisma'`

---

## ๐ก ูฺฉุงุช ููู

- โ ูุงู `.env` ุฑุง ูุฑฺฏุฒ commit ูฺฉูุฏ (ุฏุฑ `.gitignore` ุงุณุช)
- โ ุฏุฑ production ุงุฒ ุฑูุฒ ุนุจูุฑ ูู ุงุณุชูุงุฏู ฺฉูุฏ
- โ ุจุฑุง production ุงุฒ connection pooling ุงุณุชูุงุฏู ฺฉูุฏ
- โ Backup ููุธู ุงุฒ ุฏุชุงุจุณ ุจฺฏุฑุฏ

---

## ๐ ฺฉูฺฉ ุจุดุชุฑ

ุงฺฏุฑ ูุดฺฉู ูพุด ุขูุฏ:
1. ูุงฺฏโูุง PostgreSQL ุฑุง ุจุฑุฑุณ ฺฉูุฏ
2. ุจุฑุฑุณ ฺฉูุฏ ฺฉู ูพูุฑุช 5432 ุจุงุฒ ุงุณุช
3. ุจุฑุฑุณ ฺฉูุฏ ฺฉู firewall ูุงูุน ุงุชุตุงู ููโุดูุฏ

