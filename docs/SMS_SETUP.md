# راهنمای تنظیم SMS.ir برای ارسال OTP

## تنظیمات انجام شده

### 1. API Key
API Key در فایل `.env` اضافه شده است:
```env
SMS_IR_API_KEY=8ZFdiPeZoetznpEvQhML4ZRX5pcJe3hxhH8QuZnFzvDBFubS
```

### 2. API Endpoint
از endpoint زیر برای ارسال SMS استفاده می‌شود:
```
POST https://api.sms.ir/v1/send
```

### 3. نحوه کار

1. **تولید OTP**: یک کد 6 رقمی تصادفی تولید می‌شود
2. **ذخیره در دیتابیس**: OTP در جدول `verification_tokens` ذخیره می‌شود
3. **ارسال SMS**: با استفاده از sms.ir API، پیامک ارسال می‌شود
4. **تأیید OTP**: کاربر کد را وارد می‌کند و بررسی می‌شود

## فرمت پیامک

```
کد تأیید شما: 123456
پوشاک ایرونی
این کد برای 5 دقیقه معتبر است.
```

## تست

### در Development
- ✅ **SMS ارسال می‌شود** (همانند production)
- OTP در console نمایش داده می‌شود (برای راحتی تست)
- OTP در response API برمی‌گردد (برای تست - اگر SMS ارسال نشد)
- اگر SMS ارسال نشد، OTP در response برمی‌گردد تا بتوانید تست کنید

### در Production
- ✅ SMS ارسال می‌شود
- OTP در response برنمی‌گردد
- اگر SMS ارسال نشد، خطا نمایش داده می‌شود

## خطاها

اگر خطایی در ارسال SMS رخ دهد:
- OTP از دیتابیس حذف می‌شود
- خطای مناسب به کاربر نمایش داده می‌شود
- در development، جزئیات خطا نمایش داده می‌شود

## نکات مهم

1. **اعتبار حساب**: مطمئن شوید که اعتبار حساب sms.ir کافی است
2. **شماره خط**: اگر از خط اختصاصی استفاده می‌کنید، باید در API تنظیم شود
3. **Rate Limiting**: sms.ir ممکن است محدودیت تعداد ارسال داشته باشد
4. **Template**: می‌توانید از template های sms.ir استفاده کنید (نیاز به تنظیمات بیشتر)

## تغییرات آینده

اگر می‌خواهید از template استفاده کنید:
1. در پنل sms.ir یک template ایجاد کنید
2. API endpoint را به `/v1/send/verify` تغییر دهید
3. از `templateId` و `parameters` استفاده کنید

